@model IEnumerable<DepartmentViewModel>

@{
    ViewData["Title"] = "Departments";
}

<h1>Departments</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Teachers</th>
            <th>Courses</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.TeacherCount)</td>
                <td>@Html.DisplayFor(modelItem => item.CourseCount)</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.DepartmentID">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.DepartmentID">Details</a> |
                    <a asp-action="Delete" asp-route-id="@item.DepartmentID">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        $(document).ready(function() {
            let currentPage = 1;
            const allRows = $('.department-row');
            let visibleRows = allRows;
            const rowsPerPage = 5;

            function showPage(page) {
                const totalPages = Math.ceil(visibleRows.length / rowsPerPage);
                if (page < 1) page = 1;
                if (page > totalPages) page = totalPages;
                currentPage = page;

                const startIndex = (page - 1) * rowsPerPage;
                const endIndex = startIndex + rowsPerPage;

                allRows.hide();
                visibleRows.slice(startIndex, endIndex).show();
                updatePagination();
            }

            function updatePagination() {
                const totalPages = Math.ceil(visibleRows.length / rowsPerPage);
                const pagination = $('#pagination');
                pagination.empty();

                if (totalPages <= 1) {
                    pagination.hide();
                    return;
                }
                pagination.show();

                pagination.append(`
                    <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" aria-label="Previous" data-page="${currentPage - 1}">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                `);

                for (let i = 1; i <= totalPages; i++) {
                    pagination.append(`
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" data-page="${i}">${i}</a>
                        </li>
                    `);
                }

                pagination.append(`
                    <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" aria-label="Next" data-page="${currentPage + 1}">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                `);
            }

            $('#searchInput').on('keyup', function() {
                const searchText = $(this).val().toLowerCase();

                if (searchText === '') {
                    visibleRows = allRows;
                } else {
                    visibleRows = allRows.filter(function() {
                        return $(this).data('name').includes(searchText);
                    });
                }

                currentPage = 1;
                showPage(currentPage);
            });

            $(document).on('click', '.page-link', function(e) {
                e.preventDefault();
                const page = $(this).data('page');
                if (!isNaN(page)) {
                    showPage(parseInt(page));
                }
            });

            showPage(currentPage);
        });
    </script>
}